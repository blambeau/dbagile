(plug AgileTable[], AgileKeys[:candidate => /[#]$/])

start_transaction
  (fact! :people, {:'p#' => 1, :name => "blambeau"})

  (assert "It's a fact that there exists a people named blambeau",
    (fact? :people, :name => "blambeau"))

  (fact! :people, {:'p#' => 1, :name => "blablabla"})

  (assert_false "It's no more a fact that there exists a people named blambeau",
    (fact? :people, :name => "blambeau"))

  (assert "It's a fact that there exists a people named blablabla",
    (fact? :people, :name => "blablabla"))

  (delete :people)
  (fact! :people, [
    {:'p#' => 1, :name => "blambeau"}, 
    {:'p#' => 2, :name => "llambeau"}
  ])
  (assert "fact! supports arrays of tuples",
    (equal? [
      {:'p#' => 1, :name => "blambeau"}, 
      {:'p#' => 2, :name => "llambeau"}
    ], (sort_on (to_a :people), :'p#')))
commit